<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yerlika</title>
    <link rel="stylesheet" href="style.css">
    <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 32px 22px 24px 22px;
      border-radius: 12px;
      width: 94%; max-width: 350px;
      text-align: center;
      position: relative;
      box-shadow: 0 2px 16px rgba(0,0,0,0.16);
      font-family: "Roboto", sans-serif;
      margin: auto;
      animation: modalpop 0.22s;
    }
    @keyframes modalpop {
      from {transform: scale(0.8);}
      to {transform: scale(1);}
    }
    .close {
      position: absolute;
      top: 10px; right: 18px; font-size: 30px;
      color: #888; cursor: pointer; font-weight: bold;
      transition: color 0.2s;
    }
    .close:hover {color: #222;}
    #preview img {
      margin-top: 17px;
      border-radius: 7px;
      border: 1px solid #ccc;
      max-width: 90%;
      max-height: 230px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.07);
    }
    #fileInput {
      margin-top: 18px;
      margin-bottom: 7px;
      font-size: 1rem;
      padding: 6px;
    }
    #promptInput {
      width: 96%;
      margin-top: 13px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #bbb;
      resize: vertical;
      font-family: inherit;
      font-size: 1rem;
    }
    #sendToAI {
      margin-top: 15px;
      padding: 10px 18px;
      width: 100%;
      border-radius: 22px;
      font-size: 1.08rem;
      background: #89f3b8;
      border: 1px solid #222;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    #sendToAI:hover {
      background: #70e7a8;
    }
    #aiResponse {
      margin-top: 15px;
      font-size: 0.97rem;
      color: #333;
      min-height: 22px;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="navbar">
            <div class="logo">
                <a href="#">Yerlika</a>
            </div>
            <ul>
                <li><a href="#" class="active">Ana Sayfa</a></li>
                <li><a href="ürünler.html">Ürünler</a></li>
                <li><a href="iletişim.html">İletişim</a></li>
                <li><a href="hakkımızda.html">Hakkımızda</a></li>
            </ul>
        </div>
        <div class="center">
            <h1>Yerlika</h1>
            <h2>Hoş Geldiniz!</h2>
            <div class="buttons">
                <button id="openUploadModal">Yerlika'yı dene</button>
                <button>İndirimler</button>
            </div>
        </div>
    </div>    

    <!-- Modal Başlangıcı -->
    <div id="uploadModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2 style="font-size:1.18rem;margin-bottom:10px;">Ürünü Yorumla</h2>
        <input type="file" id="fileInput" accept="image/*" />
        <div id="preview"></div>
        <textarea id="promptInput" rows="4" placeholder="Ürün hakkında yorumunuzu veya sorunuzu yazın..."></textarea>
        <button id="sendToAI">Yapay Zekaya gönder</button>
        <p id="aiResponse"></p>
      </div>
    </div>

    <script>
    // Modal açma-kapama ve temizlik
    document.getElementById("openUploadModal").onclick = function() {
      document.getElementById("uploadModal").style.display = "flex";
    };
    document.getElementById("closeModal").onclick = function() {
      document.getElementById("uploadModal").style.display = "none";
      clearModalFields();
    };
    window.onclick = function(event) {
      if (event.target == document.getElementById("uploadModal")) {
        document.getElementById("uploadModal").style.display = "none";
        clearModalFields();
      }
    };
    function clearModalFields() {
      document.getElementById("preview").innerHTML = "";
      document.getElementById("fileInput").value = "";
      document.getElementById("promptInput").value = "";
      document.getElementById("aiResponse").textContent = "";
    }

    // Fotoğraf önizleme
    document.getElementById("fileInput").addEventListener("change", function(event) {
      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      const file = event.target.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement("img");
          img.src = e.target.result;
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      } else {
        preview.textContent = "Yalnızca görsel dosyası seçebilirsiniz.";
      }
    });

    // Gönder butonu
    // Gönder butonu
document.getElementById("sendToAI").addEventListener("click", async function () {
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];
  const prompt = document.getElementById("promptInput").value.trim();
  const aiResponse = document.getElementById("aiResponse");

  if (!file || !file.type.startsWith("image/")) {
    aiResponse.style.color = "#c22";
    aiResponse.textContent = "Lütfen geçerli bir görsel seçin.";
    return;
  }
  if (!prompt) {
    aiResponse.style.color = "#c22";
    aiResponse.textContent = "Lütfen yorum veya soru yazın.";
    return;
  }

  aiResponse.style.color = "#333";
  aiResponse.textContent = "İşleniyor, lütfen bekleyin...";

  const formData = new FormData();
  formData.append("image", file);
  formData.append("prompt", prompt);

  try {
    const response = await fetch('http://localhost:5000/gemini-analyze', {
      method: "POST",
      body: formData
    });

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(errorText || `Sunucu hatası: ${response.status}`);
    }

    const data = await response.json();
    aiResponse.style.color = "#2a3";
    aiResponse.textContent = data.result || "AI'den yanıt alınamadı.";
  } catch (error) {
    aiResponse.style.color = "#c22";
    aiResponse.textContent = "Sunucu hatası: " + error.message;
  }
});
    </script>
</body>
</html>